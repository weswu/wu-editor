<!DOCTYPE html>
<html>
<head>
    <title>文本编辑器-伟仔</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="ueditor.all.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="lang/zh-cn/zh-cn.js"></script>

    <style type="text/css">
        .body{
          padding: 20px;
        }
    </style>
</head>
<body>
<div class="body">
    <script id="editor" type="text/plain"></script>
</div>

<script type="text/javascript">
    var ctx = this;
    // 其它传入数据
    this.options = {
      viewId: 'editor',
      content: '<div style="color:red">吴大人</div>',
      width: 900,
      height: 480
    }

    //实例化编辑器
    this.ue = UE.getEditor(this.options.viewId ,{
      toolbars: [
        ['fullscreen', 'source', '|', 'undo', 'redo', '|', 'fontsize', '|', 'blockquote', 'horizontal', '|', 'removeformat', 'formatmatch', 'link', 'unlink'],
        ['bold', 'italic', 'underline', 'forecolor', 'backcolor', '|', 'indent', '|', 'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|'
        ,'rowspacingtop', 'rowspacingbottom', 'lineheight', '|', 'insertorderedlist', 'insertunorderedlist', '|'
        ,'imagenone', 'imageleft', 'imageright', 'imagecenter'],
        ['fontfamily', 'letterspacing', '|','fontborder','strikethrough', 'superscript', 'subscript', 'autotypeset', 'pasteplain', '|',
          'insertimage', 'emotion', 'map', '|', 'inserttable', 'searchreplace']
       ],
      elementPathEnabled:false,
      wordCount:false,
      initialFrameWidth: this.options.width || 800,
      initialFrameHeight: this.options.height || 600,
      autoHeightEnabled:false,
      saveInterval:500,
      catchRemoteImageEnable:false,		// 防止远程抓取图片
      enterTag:'p'						// 去掉自动添加的p和br标签
    });

    this.ue.addListener( 'ready', function() {
        UE.dom.domUtils.on($('.edui-for-insertimage')[0], "click",function(e){
          //图片上传
          //ctx.picUpload();
        });
        //ctx._initToolTip();
        ctx.ue && ctx.ue.focus(true) // 获取焦点
        // false时替换编辑器所有数据  true时追加数据，兼容script标签
        this.setContent( ctx.options.content, false);
    });

    //图片替换
    this.ue.addListener( 'selectionchange', function( editor, causeByUi ) {
      if (!causeByUi) return;
      var img = ctx.ue.selection.getRange().getClosedNode();
      if (img && img.tagName == 'IMG') {
        if (img.className.indexOf("edui-faked-video") == -1 && img.className.indexOf("edui-upload-video") == -1 &&
          img.className.indexOf("edui-faked-webapp") == -1 && img.src.indexOf("http://api.map.baidu.com") == -1 &&
          img.className.indexOf("edui-faked-music") == -1 && img.src.indexOf("http://maps.google.com/maps/api/staticmap") == -1 &&
          !img.getAttribute("anchorname") && !img.getAttribute("word_img")) {

            setTimeout(function(){
              $('.edui-default .edui-clickable1').click(function(){
                ctx.picUpload('replace',img);
              })
            },500)
        }
      }
    });      


</script>
<script type="text/javascript">
    // 辅助功能
    // 获取数据
    function getContent() {
      return this.ue.getContent();
    }

    // 添加内容
    function insertHtml(html) {
      this.ue.execCommand('inserthtml', '插入html代码');
    }

    // 是否有内容
    function hasContent() {
      if(!this.ue.hasContents()){
        alert('内容不能为空')
      }else{
        alert('有内容')
      }
    }

    // 不能会员时不能编辑
    function setEnabled(member) {
      if(member){
        this.ue.setEnabled();
        // this.ue.setShow(); 显示编辑器
      }else{
        this.ue.setDisabled('fullscreen');
        // this.ue.setHide(); 隐藏编辑器
      }
    }

    // 获取草稿箱内容
    function getLocalData () {
        this.ue.execCommand("getlocaldata" );
    }

    // 清空草稿箱
    function clearLocalData () {
        this.ue.execCommand( "clearlocaldata" );
    }
</script>
</body>
</html>
